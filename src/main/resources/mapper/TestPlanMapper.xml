<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.master.tsim.mapper.TestPlanMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="cn.master.tsim.entity.TestPlan">
        <id column="id" property="id" />
        <result column="name" property="name" />
        <result column="description" property="description" />
        <result column="project_id" property="projectId" />
        <result column="story_id" property="storyId" />
        <result column="del_flag" property="delFlag" />
        <result column="start_date" property="startDate" />
        <result column="end_date" property="finishDate" />
        <result column="duty_man" property="dutyMan" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, name, description, project_id, story_id, del_flag, start_date, end_date,duty_man
    </sql>
    <select id="getPassRateByPlanAndModule" resultType="java.lang.String">
        SELECT
            bb.total / aa.total
        FROM
            (
                SELECT
                    COUNT( 1 ) total
                FROM
                    t_plan_case_ref t1
                        INNER JOIN t_case t2 ON t2.id = t1.case_id
                WHERE
                    t1.plan_id = #{planId}
                  AND t2.module_id = #{moduleId} and t1.run_status='1'
            ) aa,(
                SELECT
                    COUNT( 1 ) total
                FROM
                    t_plan_case_ref t1
                        INNER JOIN t_case t2 ON t2.id = t1.case_id
                WHERE
                    t1.plan_id = #{planId}
                  AND t2.module_id = #{moduleId}
                  AND t1.run_result = '1' and t1.run_status='1'
            ) bb
    </select>

</mapper>
